@page
@model CamposRepresentacoes.Pages.Pedidos.IndexModel
@{
    ViewData["Title"] = "Emissão de Pedido";
}

<div class="container mt-5">
    <form method="post">
        <!-- Seleção de Cliente, Fornecedor e Transportadora -->
        <div class="form-group">
            <label for="clienteSelect">Selecione o Cliente:</label>
            <select class="form-control" asp-for="Pedido.IdCliente">
                <option value="">Selecione...</option>
                @if (Model.Clientes != null)
                {
                    @foreach (var cliente in Model.Clientes)
                    {
                        <option value="@cliente.Id">@cliente.RazaoSocial</option>
                    }
                }
            </select>
        </div>

        <div class="form-group">
            <label for="fornecedorSelect">Selecione o Fornecedor:</label>
            <select class="form-control" asp-for="Pedido.IdFornecedor">
                <option value="">Selecione...</option>
                @if (Model.Fornecedores != null)
                {
                    @foreach (var fornecedor in Model.Fornecedores)
                    {
                        <option value="@fornecedor.Id">@fornecedor.RazaoSocial</option>
                    }
                }
            </select>
        </div>

        <div class="form-group">
            <label for="transportadoraSelect">Selecione a Transportadora:</label>
            <select class="form-control" asp-for="Pedido.IdTransportadora">
                <option value="">Selecione...</option>
                @if (Model.Transportadoras != null)
                {
                    @foreach (var transportadora in Model.Transportadoras)
                    {
                        <option value="@transportadora.Id">@transportadora.RazaoSocial</option>
                    }
                }
            </select>
        </div>

        <!-- Botão para buscar produtos -->
        <button id="btnBuscarProdutos" type="button" class="btn btn-primary mt-2">Buscar Produtos</button>
    </form>

    <!-- Tabela de Produtos -->
    <div id="tabelaProdutos" style="display: none;">
        <!-- Preenchida dinamicamente com produtos -->
    </div>

    <!-- Carrinho -->
    <div id="carrinho" style="display: none;">
        <!-- Preenchido dinamicamente com itens do carrinho -->
        <button id="btnFinalizarPedido" class="btn btn-success mt-2">Finalizar Pedido</button>
        <button id="btnCancelarPedido" class="btn btn-danger mt-2">Cancelar Pedido</button>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function () {
            $('#btnBuscarProdutos').click(function () {
                var idFornecedor = $('#fornecedorSelect').val();

                $.get("/Pedidos/Index?handler=ObterProdutosPorFornecedor", { idFornecedor: idFornecedor }, function (data) {
                    // Atualizar a interface com a lista de produtos (substitua isso pela sua lógica real)
                    console.log(data); // Exemplo de log dos dados recebidos
                });
            });
        });
        

        // Lógica para adicionar produto ao carrinho
        $('#tabelaProdutos').on('click', '.btnAddProduto', function () {
            // Lógica para adicionar produto ao carrinho e salvar no backend
            
            $.post("/Pedidos/Index?handler=AdicionarProdutoAoCarrinho", { produtoId: $(this).data('produto-id') }, function (data) {
            });
            // Exibir o carrinho
            $('#carrinho').show();
        });

        // Lógica para finalizar pedido
        $('#btnFinalizarPedido').click(function () {
            // Lógica para finalizar o pedido e salvar no backend
            // Exemplo: $.post("/Pedidos/FinalizarPedido", function (data) {
            //     // Redirecionar ou atualizar a interface conforme necessário
            // });
        });

        // Lógica para cancelar pedido
        $('#btnCancelarPedido').click(function () {
            // Lógica para cancelar o pedido e deletar itens e capa no backend
            // Exemplo: $.post("/Pedidos/CancelarPedido", function (data) {
            //     // Redirecionar ou atualizar a interface conforme necessário
            // });
        });
    </script>
}
